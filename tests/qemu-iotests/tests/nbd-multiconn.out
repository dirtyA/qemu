QA output created by nbd-multiconn

=== Initial image setup ===

Formatting 'TEST_DIR/t.IMGFMT', fmt=IMGFMT size=4194304
wrote 2097152/2097152 bytes at offset 0
2 MiB, X ops; XX:XX:XX.X (XXX YYY/sec and XXX ops/sec)
wrote 2097152/2097152 bytes at offset 2097152
2 MiB, X ops; XX:XX:XX.X (XXX YYY/sec and XXX ops/sec)
{"execute":"qmp_capabilities"}
{"return": {}}
{"execute":"blockdev-add",
  "arguments":{"driver":"IMGFMT", "node-name":"n",
    "file":{"driver":"file", "filename":"TEST_DIR/t.IMGFMT"}}}
{"return": {}}

=== Default nbd server settings ===

{"execute":"nbd-server-start",
  "arguments":{"addr":{"type":"unix",
    "data":{"path":"SOCK_DIR/qemu-nbd.sock"}}}}
{"return": {}}
{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"r", "node-name":"n",
    "name":"r"}}
{"return": {}}
{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"w", "node-name":"n",
    "name":"w", "writable":true}}
{"return": {}}
nbdsh passed
nbdsh passed
{"execute":"block-export-del",
  "arguments":{"id":"r"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "r"}}
{"execute":"block-export-del",
  "arguments":{"id":"w"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "w"}}

=== Per-export overrides of defaults ===

{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"r", "node-name":"n",
    "name":"r", "multi-conn":"off"}}
{"return": {}}
{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"w", "node-name":"n",
    "name":"w", "multi-conn":"on", "writable":true}}
{"return": {}}
nbdsh passed
nbdsh passed
{"execute":"block-export-del",
  "arguments":{"id":"r"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "r"}}
{"execute":"block-export-del",
  "arguments":{"id":"w"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "w"}}
{"execute":"nbd-server-stop"}
{"return": {}}

=== Limit nbd server max-connections ===

{"execute":"nbd-server-start",
  "arguments":{"max-connections":1, "addr":{"type":"unix",
    "data":{"path":"SOCK_DIR/qemu-nbd.sock"}}}}
{"return": {}}
{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"r", "node-name":"n",
    "name":"r", "multi-conn":"on"}}
{"return": {}}
nbdsh passed
{"execute":"block-export-del",
  "arguments":{"id":"r"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "r"}}
{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"w", "node-name":"n",
    "name":"w", "multi-conn":"on", "writable":true}}
{"return": {}}
nbdsh passed
{"execute":"block-export-del",
  "arguments":{"id":"w"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "w"}}
{"execute":"nbd-server-stop"}
{"return": {}}

=== Demonstrate parallel writers ===

{"execute":"nbd-server-start",
  "arguments":{"addr":{"type":"unix",
    "data":{"path":"SOCK_DIR/qemu-nbd.sock"}}}}
{"return": {}}
{"execute":"block-export-add",
  "arguments":{"type":"nbd", "id":"w", "node-name":"n",
    "name":"", "multi-conn":"on", "writable":true}}
{"return": {}}
Flush appears to be consistent across connections
{"execute":"block-export-del",
  "arguments":{"id":"w"}}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "BLOCK_EXPORT_DELETED", "data": {"id": "w"}}
{"execute":"nbd-server-stop"}
{"return": {}}
{"execute":"quit"}
{"return": {}}
{"timestamp": {"seconds":  TIMESTAMP, "microseconds":  TIMESTAMP}, "event": "SHUTDOWN", "data": {"guest": false, "reason": "host-qmp-quit"}}
*** done
